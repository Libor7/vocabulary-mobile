import fs from "fs";
import path from "path";

const projectRoot = process.cwd();
const localesDir = path.join(projectRoot, "app", "locales");
const outputFile = path.join(
  projectRoot,
  "app",
  "i18n",
  "resources.generated.ts"
);

const languages = fs
  .readdirSync(localesDir)
  .filter((name) => fs.statSync(path.join(localesDir, name)).isDirectory());

const lines = [];

lines.push("// AUTO-GENERATED FILE â€” DO NOT EDIT");
lines.push("// Generated by scripts/generate-i18n-resources.mjs");
lines.push("");
lines.push("export const resources = {");

for (const lang of languages) {
  const langDir = path.join(localesDir, lang);
  const files = fs.readdirSync(langDir).filter((f) => f.endsWith(".json"));

  lines.push(`  ${lang}: {`);

  for (const file of files) {
    const namespace = file.replace(".json", "");
    lines.push(`    '${namespace}': require('../locales/${lang}/${file}'),`);
  }

  lines.push("  },");
}

lines.push("} as const;");
lines.push("");
lines.push(
  `export const SUPPORTED_LANGUAGES = ${JSON.stringify(languages)} as const;`
);
lines.push("export type Language = typeof SUPPORTED_LANGUAGES[number];");

fs.writeFileSync(outputFile, lines.join("\n"));

console.log(`i18n resources generated (${languages.length} languages)`);
